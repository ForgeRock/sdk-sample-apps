<!--
angular-todo-prototype

form.component.html

Copyright (c) 2021 ForgeRock. All rights reserved.
This software may be modified and distributed under the terms
of the MIT license. See the LICENSE file for details.
-->

<form (submit)="submitHandler($event)">
  @if (formAction()) {
    <div class="cstm_form-icon text-center mb-3">
      @switch (formAction()) {
        @case ('SIGNON') {
          <app-key-icon size="72px" />
        }
        @case ('REGISTER') {
          <app-new-user-icon size="72px" />
        }
        @default {}
      }
    </div>
  }
  @if (!node() || node().status === 'start') {
    <app-loading message="Checking your session..."></app-loading>
  } @else if (node().status === 'success') {
    <app-alert type="success" message="Success! You're logged in."></app-alert>
  } @else if (node().status === 'continue' && collectors().length) {
    @if (formName() && !hasProtectCollector(collectors())) {
      <h1 class="text-center fs-2 mb-3">{{ formName() }}</h1>
    }
    @for (collector of collectors(); track collector) {
      @if (collector.type === 'TextCollector' && collector.name === 'protectsdk') {
        <app-protect
          [label]="collector.output.label"
          [update]="updater()(collector)"
          [submitProtect]="submitProtectCallback"
        />
      } @else {
        @switch (collector.type) {
          @case ('TextCollector') {
            <app-text-input
              [key]="collector.output.key"
              [label]="collector.output.label"
              [update]="updater()(collector)"
            />
          }
          @case ('PasswordCollector') {
            <app-password
              [key]="collector.output.key"
              [label]="collector.output.label"
              [update]="updater()(collector)"
            />
          }
          @case ('SubmitCollector') {
            <app-submit-button
              [key]="collector.output.key"
              [label]="collector.output.label"
              [submittingForm]="isSubmittingForm"
            />
          }
          @case ('FlowCollector') {
            <app-flow-link [collector]="collector" [startNewFlow]="startNewFlow" />
          }
          @default {
            <app-unknown [collector]="collector" />
          }
        }
      }
    }
  } @else if (node().status === 'error') {
    <app-alert type="error" [message]="errorMessage()" />
  } @else {
    <app-alert type="error" message="Unknown node status" />
  }
</form>
